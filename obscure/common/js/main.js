(function(a,b){if(typeof define==="function"&&define.amd){define(["exports"],b)}else{if(typeof exports==="object"){b(exports)}else{b((a.commonJsStrict={}))}}}(this,function(a){function b(g,f,e){this.obj=g;this.left=null;this.right=null;this.parent=e;this.dimension=f}function d(h,f,j){var e=this;function i(m,p,l){var o=p%j.length,k,n;if(m.length===0){return null}if(m.length===1){return new b(m[0],o,l)}m.sort(function(r,q){return r[j[o]]-q[j[o]]});k=Math.floor(m.length/2);n=new b(m[k],o,l);n.left=i(m.slice(0,k),p+1,n);n.right=i(m.slice(k+1),p+1,n);return n}function g(l){e.root=l;function k(m){if(m.left){m.left.parent=m;k(m.left)}if(m.right){m.right.parent=m;k(m.right)}}k(e.root)}if(!Array.isArray(h)){g(h,f,j)}else{this.root=i(h,0,null)}this.toJSON=function(l){if(!l){l=this.root}var k=new b(l.obj,l.dimension,null);if(l.left){k.left=e.toJSON(l.left)}if(l.right){k.right=e.toJSON(l.right)}return k};this.insert=function(k){function l(q,p){if(q===null){return p}var r=j[q.dimension];if(k[r]<q.obj[r]){return l(q.left,q)}else{return l(q.right,q)}}var n=l(this.root,null),m,o;if(n===null){this.root=new b(k,0,null);return}m=new b(k,(n.dimension+1)%j.length,n);o=j[n.dimension];if(k[o]<n.obj[o]){n.left=m}else{n.right=m}};this.remove=function(l){var m;function k(o){if(o===null){return null}if(o.obj===l){return o}var p=j[o.dimension];if(l[p]<o.obj[p]){return k(o.left,o)}else{return k(o.right,o)}}function n(s){var o,q,p;function r(w,z){var y,t,x,v,u;if(w===null){return null}y=j[z];if(w.dimension===z){if(w.left!==null){return r(w.left,z)}return w}t=w.obj[y];x=r(w.left,z);v=r(w.right,z);u=w;if(x!==null&&x.obj[y]<t){u=x}if(v!==null&&v.obj[y]<u.obj[y]){u=v}return u}if(s.left===null&&s.right===null){if(s.parent===null){e.root=null;return}p=j[s.parent.dimension];if(s.obj[p]<s.parent.obj[p]){s.parent.left=null}else{s.parent.right=null}return}if(s.right!==null){o=r(s.right,s.dimension);q=o.obj;n(o);s.obj=q}else{o=r(s.left,s.dimension);q=o.obj;n(o);s.right=s.left;s.left=null;s.obj=q}}m=k(e.root);if(m===null){return}n(m)};this.nearest=function(l,m,q){var o,k,n;n=new c(function(r){return -r[1]});function p(v){var u,w=j[v.dimension],r=f(l,v.obj),y={},t,z,x;function s(A,B){n.push([A,B]);if(n.size()>m){n.pop()}}for(x=0;x<j.length;x+=1){if(x===v.dimension){y[j[x]]=l[j[x]]}else{y[j[x]]=v.obj[j[x]]}}t=f(y,v.obj);if(v.right===null&&v.left===null){if(n.size()<m||r<n.peek()[1]){s(v,r)}return}if(v.right===null){u=v.left}else{if(v.left===null){u=v.right}else{if(l[w]<v.obj[w]){u=v.left}else{u=v.right}}}p(u);if(n.size()<m||r<n.peek()[1]){s(v,r)}if(n.size()<m||Math.abs(t)<n.peek()[1]){if(u===v.left){z=v.right}else{z=v.left}if(z!==null){p(z)}}}if(q){for(o=0;o<m;o+=1){n.push([null,q])}}if(e.root){p(e.root)}k=[];for(o=0;o<Math.min(m,n.content.length);o+=1){if(n.content[o][0]){k.push([n.content[o][0].obj,n.content[o][1]])}}return k};this.balanceFactor=function(){function k(m){if(m===null){return 0}return Math.max(k(m.left),k(m.right))+1}function l(m){if(m===null){return 0}return l(m.left)+l(m.right)+1}return k(e.root)/(Math.log(l(e.root))/Math.log(2))}}function c(e){this.content=[];this.scoreFunction=e}c.prototype={push:function(e){this.content.push(e);this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0];var f=this.content.pop();if(this.content.length>0){this.content[0]=f;this.sinkDown(0)}return e},peek:function(){return this.content[0]},remove:function(h){var e=this.content.length;for(var g=0;g<e;g++){if(this.content[g]==h){var f=this.content.pop();if(g!=e-1){this.content[g]=f;if(this.scoreFunction(f)<this.scoreFunction(h)){this.bubbleUp(g)}else{this.sinkDown(g)}}return}}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(h){var e=this.content[h];while(h>0){var g=Math.floor((h+1)/2)-1,f=this.content[g];if(this.scoreFunction(e)<this.scoreFunction(f)){this.content[g]=e;this.content[h]=f;h=g}else{break}}},sinkDown:function(f){var e=this.content.length,j=this.content[f],l=this.scoreFunction(j);while(true){var i=(f+1)*2,o=i-1;var g=null;if(o<e){var m=this.content[o],p=this.scoreFunction(m);if(p<l){g=o}}if(i<e){var k=this.content[i],h=this.scoreFunction(k);if(h<(g==null?l:p)){g=i}}if(g!=null){this.content[f]=this.content[g];this.content[g]=j;f=g}else{break}}}};this.kdTree=d;a.kdTree=d;a.BinaryHeap=c}));var viewWidth=0,viewHeight=0,canvas=document.getElementById("obs-ca"),ctx=canvas.getContext("2d");var osCanvas=document.createElement("canvas"),osCtx=osCanvas.getContext("2d");var settings={width:400,height:400,threshold:250,sampleScale:1,maxWeight:24,frameStep:4,lineWidth:0.1};var outputPath,outputTree,currentFrame=0;var image=document.createElement("img");image.crossOrigin="Anonymous";image.src="/obscure/common/img/sketch.jpg";image.onload=function(){viewWidth=canvas.width=canvas.clientWidth;viewHeight=canvas.height=canvas.clientHeight;osCanvas.width=settings.width;osCanvas.height=settings.height;processImage();osCanvas.width=viewWidth;osCanvas.height=viewHeight};function processImage(){console.log("processing...");var d=Date.now();var b=getPointsFromImage();var c=Date.now();console.log("point count:",b.length);console.log("image processing took:",(c-d));generatePathFromPoints(b);var a=Date.now();console.log("path finding took:",(a-c));osCtx.clearRect(0,0,settings.width,settings.height)}function getPointsFromImage(){var m=settings.threshold,q=settings.sampleScale,e=q*(settings.width/viewWidth),h=1/e,l=settings.maxWeight,f=(osCanvas.height*q)|0;osCtx.drawImage(image,0,0,f,f);var c=this.osCtx.getImageData(0,0,f,f),j=c.data,v=[];for(var k=0;k<j.length;k+=4){var a=j[k],n=j[k+1],t=j[k+2],o=((a+n+t)/3)|0,u=((k/4)%f)*h,s=((k/4/f)|0)*h;if(o>m){var d={x:u+randomRange(-0.1,0.1),y:s+randomRange(-0.1,0.1),weight:map(o,m,255,1,l)|0};v.push(d)}}return v}function generatePathFromPoints(i){var c=Math.random;var a=function(m,k){var n=(m.x-k.x)*(c()-0.5);var l=(m.y-k.y)*(c()-0.5);return n*n+l*l},g=["x","y"];var d=new kdTree(i,a,g),f=new kdTree(i,a,g),j=[],h=i[0],b=i.length,e;while(b){e=d.nearest(h,1)[0][0];h=e;d.remove(h);j.push(h);b--}outputPath=j;outputTree=f}function update(){this.updateDrawing();this.drawToCanvas();requestAnimationFrame(update)}function updateDrawing(){var a=outputPath[currentFrame],d=0,b=settings.frameStep;osCtx.strokeStyle="#333";osCtx.lineWidth=settings.lineWidth;var c;while((++d<=b)&&a){osCtx.beginPath();osCtx.moveTo(a.x,a.y);c=outputTree.nearest(a,a.weight);c.forEach(function(e){osCtx.lineTo(e[0].x,e[0].y)});osCtx.stroke();a=outputPath[++this.currentFrame]}}function drawToCanvas(){ctx.clearRect(0,0,viewWidth,viewHeight);ctx.drawImage(osCanvas,0,0,viewWidth,viewHeight)}function randomRange(b,a){return b+Math.random()*(a-b)}function map(e,b,a,d,c){return((e-b)/(a-b))*(c-d)+d}$(function(){function d(){var i=$(window).height();var h=$(window).width();$("#main-visual").css({height:i});var j=i*i+h*h;j=Math.sqrt(j);$("#main-visual-bg").css({height:j})}d();var f=new TimelineMax();var c=$("#js-modal-layer");$(document).on("click","#js-instalib li a",function(){var h=$(this).find("img").attr("src");$("#img-insta").addClass("block").css({top:$(document).scrollTop()+40});f.to(c,0,{opacity:".7",onComplete:function(){c.addClass("block")}});$("#img-insta").append("<img src="+h+' alt="">');return false});c.on("click",function(){f.to($("#img-insta").find("img"),0.2,{opacity:"0",transform:"scale(.2)",onComplete:function(){$("#img-insta").find("img").remove();$("#img-insta").removeClass("block")}});f.to($(this),0.3,{opacity:"0",onComplete:function(){c.removeClass("block")}})});var g=function(){if(window.innerWidth){return window.innerWidth}else{if(document.documentElement&&document.documentElement.clientWidth!==0){return document.documentElement.clientWidth}else{if(document.body){return document.body.clientWidth}}}return 0};var e=window.innerWidth;window.addEventListener("resize",function(){d();if(e==window.innerWidth){return}e=window.innerWidth;b()});function b(){var i=$("#obs-ca");var h=$("#wrap-canvas");i.attr({height:h.height()});i.attr({width:h.width()})}b();var a=true;$("html,body").animate({scrollTop:0},0);$(window).scroll(function(){var i=$(".main").offset().top;var h=$(document).scrollTop()+(window.innerHeight/2);if(h>i&&a===true){$("#js-instalib li").addClass("item");if(navigator.userAgent.indexOf("iPhone")>0||navigator.userAgent.indexOf("iPad")>0||navigator.userAgent.indexOf("iPod")>0||navigator.userAgent.indexOf("Android")>0){$("#main").addClass("sp")}else{requestAnimationFrame(update)}a=false}})});
